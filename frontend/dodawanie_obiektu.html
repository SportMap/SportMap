<html>

<head>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="logon-box-style.css">
    <link rel="stylesheet" href="dodawanie_obiektu.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.2/jquery.min.js" integrity="sha512-tWHlutFnuG0C6nQRlpvrEhE4QpkG1nn2MOUMWmUeRePl4e3Aki0VB6W1v3oLjFtd0hVOtRQ9PHpSfN6u6/QXkQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.2/jquery.min.js" integrity="sha512-tWHlutFnuG0C6nQRlpvrEhE4QpkG1nn2MOUMWmUeRePl4e3Aki0VB6W1v3oLjFtd0hVOtRQ9PHpSfN6u6/QXkQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>

<body>

    <header>
        <div class="side_menu"></div>
        <div class="header_logo"></div>
        <div class="profile_icon"></div>
        <div class="profile_menu hidden">
            <div class="text name">Witaj</div>
            <div class="button" id="login" onclick="displayLoginBox()">Zaloguj się</div>
            <div class="button" id="register" onclick="displayRegisterBox()">Zarejestruj się</div>
            <div class="text">
                <a href="polityka.html">Polityka prywatności</a>
                <a href="warunki.html">Warunki usługi</a>
            </div>
        </div>
    </header>

    <div class="sidebar"></div>

    <div class="content">
        <div class="add-object-panel">

            <div class="title">
                <p>Dodaj obiekt</p>
            </div>

            <div class="main-container">

                <div id="add-sport-complex" class="page">
                    <div id="image-upload-container" class="image-upload-container">
                        <div id="image-preview" class="image-preview"></div>
                        <input type="file" id="complex-photo" class="input-file" accept="image/*" onchange="previewImage()">
                        <label for="complex-photo" class="upload-button">+ Dodaj zdjęcie (opcjonalne)</label>
                    </div>
                    
                    <p class="title-main">Szczegóły</p>
                    <input class="input" type="text" id="complex-name" placeholder="Nazwa obiektu" required>

                    <div class="row">
                        <select class="input" id="complex-surface">
                            <option value="TRAWA">TRAWA</option>
                            <option value="SZTUCZNA_TRAWA">SZTUCZNA TRAWA</option>
                            <option value="GLINA">GLINA</option>
                            <option value="TWARDY_KORT">TWARDY KORT</option>
                            <option value="DREWNIANA_PODŁOGA">DREWNIANA PODŁOGA</option>
                            <option value="TARTAN">TARTAN</option>
                            <option value="ASFALT">ASFALT</option>
                            <option value="PIASEK">PIASEK</option>
                            <option value="LÓD">LÓD</option>
                            <option value="AKRYL">AKRYL</option>
                        </select>
                        
                        <select class="input" id="complex-category">
                            <option value="BIEGANIE">BIEGANIE</option>
                            <option value="CROSSFIT">CROSSFIT</option>
                            <option value="FITNESS">FITNESS</option>
                            <option value="GIMNASTYKA">GIMNASTYKA</option>
                            <option value="KOSZYKÓWKA">KOSZYKÓWKA</option>
                            <option value="KRĘGLE">KRĘGLE</option>
                            <option value="LEKKOATLETYKA">LEKKOATLETYKA</option>
                            <option value="ŁYŻWIARSTWO">ŁYŻWIARSTWO</option>
                            <option value="PIŁKA_NOŻNA">PIŁKA NOŻNA</option>
                            <option value="PIŁKA_RĘCZNA">PIŁKA RĘCZNA</option>
                            <option value="PŁYWANIE">PŁYWANIE</option>
                            <option value="SIATKÓWKA">SIATKÓWKA</option>
                            <option value="SIATKÓWKA_PLAŻOWA">SIATKÓWKA PLAŻOWA</option>
                            <option value="SPORTY_EKSTREMALNE">SPORTY EKSTREMALNE</option>
                            <option value="SPORTY_SIŁOWE">SPORTY SIŁOWE</option>
                            <option value="SZTUKI_WALKI">SZTUKI WALKI</option>
                            <option value="SZACHY">SZACHY</option>
                            <option value="TANIEC">TANIEC</option>
                            <option value="TENIS_STOŁOWY">TENIS STOŁOWY</option>
                            <option value="TENIS">TENIS</option>
                            <option value="WSPINACZKA">WSPINACZKA</option>
                        </select>                        
                    </div>

                    <div class="row">
                        <input class="input" type="text" id="complex-website" placeholder="Strona internetowa (opcjonalne)">
                        <input class="input" type="text" id="complex-phone" placeholder="Numer telefonu (opcjonalne)">
                    </div>

                    <textarea class="input" id="complex-description" placeholder="Jakie są szczegółowe informacje na temat tego obiektu?" required></textarea>

                    <p class="title-main">Adres:</p>
                    <div class="row">
                        <input class="input" type="text" id="address-city" placeholder="Miasto" required>
                        <input class="input" type="text" id="address-postalCode" placeholder="Kod pocztowy (opcjonalne)">
                    </div>

                    <input class="input" type="text" id="address-street" placeholder="Ulica (opcjonalne)">

                    <div class="row">
                        <input class="input" type="text" id="address-buildingNumber" placeholder="Numer budynku (opcjonalne)">
                        <input class="input" type="text" id="address-apartmentNumber" placeholder="Numer lokalu (opcjonalne)">
                    </div>

                    <div class="row">
                    <div id="mapid" style="width: 95%; height: 200px; margin-left:2.5%; margin-bottom: 10px; border-radius: 10px;"></div>
                        <input class="input" type="text" id="complex-latitude" placeholder="Szerokość geograficzna" required>
                    <input class="input" type="text" id="complex-longitude" placeholder="Długość geograficzna" required>
                    </div>

                    <script>
                        // Initialize the map
                        var map = L.map('mapid').setView([54.35245, 18.64799], 16);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(map);

                    var marker;

                    function onMapClick(e) {
                        var lat = e.latlng.lat.toFixed(5);
                        var lng = e.latlng.lng.toFixed(5);

                        document.getElementById('complex-latitude').value = lat;
                        document.getElementById('complex-longitude').value = lng;

                        if (marker) {
                        map.removeLayer(marker);
                        }

                        marker = L.marker([lat, lng]).addTo(map);
                    }

                    map.on('click', onMapClick);
                    </script>

                    <p class="title-main">Godziny otwarcia:</p>
                    <label class="weekdays">Dostępność:</label>
                    <div class="opening-hours-availability">
                        <select class="input" id="complex-availability" onchange="toggleOpeningHours()">
                            <option value="variable">Różnie</option>
                            <option value="open247">Otwarte 24/7</option>
                        </select>
                    </div>

                    <label class="weekdays">Poniedzialek:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="monday-status" onchange="toggleDayHours('monday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="monday-openTime" class="input" style="display: inline;">
                        <input type="time" id="monday-closeTime" class="input" style="display: inline;">
                    </div>

                    <label class="weekdays">Wtorek:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="tuesday-status" onchange="toggleDayHours('tuesday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="tuesday-openTime" class="input" style="display: inline;">
                        <input type="time" id="tuesday-closeTime" class="input" style="display: inline;">
                    </div>

                    <label class="weekdays">Środa:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="wednesday-status" onchange="toggleDayHours('wednesday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="wednesday-openTime" class="input" style="display: inline;">
                        <input type="time" id="wednesday-closeTime" class="input" style="display: inline;">
                    </div>
                
                    <label class="weekdays">Czwartek:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="thursday-status" onchange="toggleDayHours('thursday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="thursday-openTime" class="input" style="display: inline;">
                        <input type="time" id="thursday-closeTime" class="input" style="display: inline;">
                    </div>
                
                    <label class="weekdays">Piątek:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="friday-status" onchange="toggleDayHours('friday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="friday-openTime" class="input" style="display: inline;">
                        <input type="time" id="friday-closeTime" class="input" style="display: inline;">
                    </div>
                
                    <label class="weekdays">Sobota:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="saturday-status" onchange="toggleDayHours('saturday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="saturday-openTime" class="input" style="display: inline;">
                        <input type="time" id="saturday-closeTime" class="input" style="display: inline;">
                    </div>
                
                    <label class="weekdays">Niedziela:</label>
                    <div class="opening-hours-day">
                        <select class="input" id="sunday-status" onchange="toggleDayHours('sunday')">
                            <option value="open">Otwarte</option>
                            <option value="closed">Zamknięte</option>
                        </select>
                        <input type="time" id="sunday-openTime" class="input" style="display: inline;">
                        <input type="time" id="sunday-closeTime" class="input" style="display: inline;">
                    </div>

                    <button class="action-button" onclick="addSportComplex()">Dodaj obiekt</button>
                </div>
                
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        toggleOpeningHours();
                    });
                
                    function toggleOpeningHours() {
                        const availability = document.getElementById('complex-availability').value;
                        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

                        if (availability === 'open247') {
                            days.forEach(day => {
                                document.getElementById(`${day}-status`).value = 'open'; // Set to "Otwarte"
                                setDayHoursEnabled(day, false); // Disable the inputs for this day
                            });
                        } else {
                            days.forEach(day => {
                                setDayHoursEnabled(day, true); // Enable the inputs for this day
                            });
                        }
                    }

                    function setDayHoursEnabled(day, enabled) {
                        const dayStatus = document.getElementById(`${day}-status`);
                        const openTime = document.getElementById(`${day}-openTime`);
                        const closeTime = document.getElementById(`${day}-closeTime`);

                        if (dayStatus) {
                            dayStatus.disabled = !enabled;
                        }
                        if (openTime) {
                            openTime.disabled = !enabled;
                        }
                        if (closeTime) {
                            closeTime.disabled = !enabled;
                        }

                        if (!enabled) {
                            if (openTime) openTime.style.display = 'none';
                            if (closeTime) closeTime.style.display = 'none';
                        } else {
                            toggleDayHours(day);
                        }
                    }

                    function toggleDayHours(day) {
                        const openTime = document.getElementById(`${day}-openTime`);
                        const closeTime = document.getElementById(`${day}-closeTime`);
                        const dayStatus = document.getElementById(`${day}-status`).value;

                        if (dayStatus === 'closed') {
                            if (openTime) openTime.style.display = 'none';
                            if (closeTime) closeTime.style.display = 'none';
                        } else {
                            if (openTime) openTime.style.display = 'inline';
                            if (closeTime) closeTime.style.display = 'inline';
                        }
                    }
                
                    function addSportComplex() {
                        if (!isFormValid()) {
                            return; // Stop the function if validation fails
                        }
                        const isOpen247 = document.getElementById('complex-availability').value === 'open247';
                        const openingHours = isOpen247 ? getDefaultOpeningHours() : getOpeningHours();

                        const data = {
                            name: getStringInputValue('complex-name'),
                            description: getStringInputValue('complex-description'),
                            category: getStringInputValue('complex-category', 'BIEGANIE'),
                            surface: getStringInputValue('complex-surface', 'TRAWA'),
                            website: getStringInputValue('complex-website'),
                            phoneNumber: getStringInputValue('complex-phone'),
                            address: {
                                street: getStringInputValue('address-street'),
                                postalCode: getStringInputValue('address-postalCode'),
                                buildingNumber: getStringInputValue('address-buildingNumber'),
                                apartmentNumber: getStringInputValue('address-apartmentNumber'),
                                city: getStringInputValue('address-city')
                            },
                            latitude: getNumberInputValue('complex-latitude', 0),
                            longitude: getNumberInputValue('complex-longitude', 0),
                            photo: getStringInputValue('complex-photo'),
                            isOpen247: isOpen247,
                            openingHours: openingHours
                        };

                        console.log('Sending POST request with data:', data);
                
                        fetch('http://localhost:8080/sport-complexes', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success:', data);
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });

                        function getOpeningHours() {
                        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                        const openingHours = {};

                        days.forEach(day => {
                            const dayStatusElement = document.querySelector(`#${day}-status`);
                            if (dayStatusElement && dayStatusElement.value === 'open') {
                                const openTimeElement = document.getElementById(`${day}-openTime`);
                                const closeTimeElement = document.getElementById(`${day}-closeTime`);
                                if (openTimeElement && closeTimeElement) {
                                    openingHours[day] = {
                                        openTime: openTimeElement.value,
                                        closeTime: closeTimeElement.value
                                    };
                                }
                            } else {
                                openingHours[day] = null;
                            }
                        });

                        return openingHours;
                    }
                    }

                    function isFormValid() {
                        const requiredFields = [
                            { id: 'complex-name', name: 'Nazwa obiektu' },
                            { id: 'complex-description', name: 'Opis' },
                            { id: 'address-city', name: 'Miasto' },
                            { id: 'complex-latitude', name: 'Szerokość geograficzna' },
                            { id: 'complex-longitude', name: 'Długość geograficzna' }
                        ];

                        let missingFields = [];

                        requiredFields.forEach(field => {
                            const inputField = document.getElementById(field.id);
                            if (!inputField || inputField.value.trim() === '') {
                                missingFields.push("\n" +field.name);
                            }
                        });

                        if (missingFields.length > 0) {
                            alert('Proszę wypełnić wymagane pola: ' + missingFields.join(', '));
                            return false;
                        }

                        return true;
                    }

                    //Change the value of null if needed to change the inputs where nothing is inserted
                    function getStringInputValue(elementId, defaultValue = null) {

                        const value = document.getElementById(elementId).value.trim();
                        const element = document.getElementById(elementId);

                        if (element.type === 'file') {
                            // For file inputs, return the file name
                            return element.files.length > 0 ? element.files[0].name : defaultValue;
                        }

                        return value === '' ? defaultValue : value;
                    }

                    function getNumberInputValue(elementId, defaultValue = 0) {
                        const value = parseFloat(document.getElementById(elementId).value);
                        return isNaN(value) ? defaultValue : value;
                    }

                    function getOpeningHours() {
                        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                        const openingHours = {};

                        days.forEach(day => {
                            const dayStatusElement = document.getElementById(`${day}-status`);
                            if (dayStatusElement && dayStatusElement.value === 'open') {
                                const openTimeElement = document.getElementById(`${day}-openTime`);
                                const closeTimeElement = document.getElementById(`${day}-closeTime`);
                                openingHours[day] = {
                                    openTime: openTimeElement.value,
                                    closeTime: closeTimeElement.value
                                };
                            } else {
                                openingHours[day] = null;
                            }
                        });

                        return openingHours;
                    }

                    function getDefaultOpeningHours() {
                        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                        const defaultHours = {};
                        days.forEach(day => defaultHours[day] = null);
                        return defaultHours;
                    }

                    function previewImage() {
                        var preview = document.getElementById('image-preview');
                        var file = document.getElementById('complex-photo').files[0];
                        var reader = new FileReader();

                        reader.onloadend = function() {
                            preview.style.backgroundImage = `url('${reader.result}')`;
                        }

                        if (file) {
                            reader.readAsDataURL(file);
                        } else {
                            preview.style.backgroundImage = "";
                        }
                    }

                </script>
                
            
                <div class="footer">
                    <a href="index.html">Wróć do strony głównej</a>
                </div>
            </div>

        </div>
    </div>

    <script src="script.js" type="application/javascript"></script>
    <script src="profile_popup.js" type="application/javascript"></script>
</body>

</html>